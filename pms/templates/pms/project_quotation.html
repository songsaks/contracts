{% load humanize %}
<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>Quotation - {{ project.name }}</title>
    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Sarabun', sans-serif;
            background: #eee;
            padding: 20px;
        }

        .a4-page {
            background: white;
            width: 210mm;
            min-height: 297mm;
            margin: 0 auto;
            padding: 20mm;
            position: relative;
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
        }

        @media print {
            body {
                background: white;
                padding: 0;
            }
            .a4-page {
                box-shadow: none;
                margin: 0;
                width: 100%;
                min-height: auto;
            }
            .no-print {
                display: none !important;
            }
        }

        .header-title {
            font-weight: 700;
            font-size: 24px;
            text-transform: uppercase;
            color: #2c3e50;
        }

        .company-info {
            font-size: 14px;
            color: #555;
        }

        .table-custom th {
            background-color: #f8f9fa !important;
            border-bottom: 2px solid #dee2e6;
        }
    </style>
</head>
<body>

    <!-- Print Control -->
    <div class="container mb-4 no-print text-center">
        <button onclick="window.print()" class="btn btn-primary me-2">พิมพ์ใบเสนอราคา (Print)</button>
        <button onclick="window.history.back()" class="btn btn-secondary">กลับ (Back)</button>
    </div>

    <!-- A4 Paper -->
    <div class="a4-page">
        <!-- Header -->
        <div class="row mb-4">
            <div class="col-8">
                <h3 class="header-title mb-1">ใบเสนอราคา (Quotation)</h3>
                <div class="company-info">
                    <strong>9Com (9com.cloud)</strong><br>
                    123 Example Road, Bangkok, Thailand<br>
                    Tel: 02-123-4567 | Email: info@9com.cloud
                </div>
            </div>
            <div class="col-4 text-end">
                <div class="border p-3 rounded bg-light">
                    <div class="mb-1"><strong>เลขที่ (No.):</strong> QT-{{ project.pk|stringformat:"04d" }}</div>
                    <div class="mb-1"><strong>วันที่ (Date):</strong> {{ today|date:"d/m/Y" }}</div>
                </div>
            </div>
        </div>

        <hr>

        <!-- Customer Info -->
        <div class="row mb-5">
            <div class="col-12">
                <h5 class="fw-bold mb-2">ลูกค้า (Customer):</h5>
                <div><strong>{{ project.customer.name }}</strong></div>
                <div>{{ project.customer.address|linebreaksbr }}</div>
                <div>Tel: {{ project.customer.phone }} | Email: {{ project.customer.email }}</div>
                <div class="mt-2 text-muted"><em>โครงการ: {{ project.name }}</em></div>
            </div>
        </div>

        <!-- Items -->
        <table class="table table-custom table-bordered mb-4">
            <thead>
                <tr class="text-center">
                    <th style="width: 5%">#</th>
                    <th style="width: 55%">รายการ (Description)</th>
                    <th style="width: 10%">จำนวน (Qty)</th>
                    <th style="width: 15%">ราคา/หน่วย (Unit Price)</th>
                    <th style="width: 15%">รวม (Total)</th>
                </tr>
            </thead>
            <tbody>
                {% for item in items %}
                <tr>
                    <td class="text-center">{{ forloop.counter }}</td>
                    <td>
                        <div class="fw-bold">{{ item.name }}</div>
                        <div class="small text-muted">{{ item.description }}</div>
                    </td>
                    <td class="text-center">{{ item.quantity }}</td>
                    <td class="text-end">{{ item.unit_price|floatformat:2|intcomma }}</td>
                    <td class="text-end">{{ item.total_price|floatformat:2|intcomma }}</td>
                </tr>
                {% endfor %}
                
                <!-- Fill empty rows if needed (aesthetic) -->
                {% if items|length < 5 %}
                <tr style="height: 50px;"><td></td><td></td><td></td><td></td><td></td></tr>
                {% endif %}
            </tbody>
            <tfoot>
                <tr>
                    <td colspan="3" rowspan="3" class="align-middle">
                        <strong>หมายเหตุ (Remarks):</strong><br>
                        - ราคานี้อาจมีการเปลี่ยนแปลงตามเงื่อนไข<br>
                        - กำหนดยืนราคา 30 วัน
                    </td>
                    <td class="text-end fw-bold">รวมเป็นเงิน (Subtotal)</td>
                    <td class="text-end">{{ subtotal|floatformat:2|intcomma }}</td>
                </tr>
                <tr>
                    <td class="text-end fw-bold">ภาษี 7% (VAT)</td>
                    <td class="text-end">{{ vat|floatformat:2|intcomma }}</td>
                </tr>
                <tr class="bg-light">
                    <td class="text-end fw-bold fs-5">จำนวนเงินรวมทั้งสิ้น (Grand Total)</td>
                    <td class="text-end fw-bold fs-5 text-primary">{{ grand_total|floatformat:2|intcomma }}</td>
                </tr>
            </tfoot>
        </table>

        <!-- Signatures -->
        <div class="row mt-5 pt-5 text-center">
            <div class="col-6">
                <div class="border-top mx-5 border-secondary pt-2">
                    ผู้เสนอราคา (Prepared By)<br>
                    9Com Logic
                </div>
            </div>
            <div class="col-6">
                <div class="border-top mx-5 border-secondary pt-2">
                    ผู้อนุมัติสั่งซื้อ (Customer Acceptance)<br>
                    (.........................................)
                </div>
            </div>
        </div>

    </div>

</body>
</html>
